<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Slides Jurídico - Cadastrar Slide</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; flex-direction:column; min-height:100vh; }
    header { background:#007bff; color:white; padding:20px; text-align:center; }
    main { flex:1; padding:20px; max-width:800px; margin:auto; }
    form { margin-bottom:30px; border:1px solid #ccc; padding:20px; border-radius:8px; }
    form input, form textarea { width:100%; padding:10px; margin:8px 0; box-sizing:border-box; }
    form button { padding:10px 20px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; }
    form button:hover { background:#0056b3; }
    .slide { border:1px solid #ddd; padding:15px; border-radius:8px; margin-bottom:15px; }
    .slide h3 { margin:0 0 5px 0; }
    footer { text-align:center; padding:15px; background:#f2f2f2; }
    footer a { text-decoration:none; color:#007bff; }
    footer a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <header>
    <h1>Cadastro de Slides</h1>
  </header>

  <main>
    <form id="slideForm">
      <label for="data">Data:</label>
      <input type="date" id="data" name="data" required>

      <label for="assunto">Assunto:</label>
      <input type="text" id="assunto" name="assunto" required>

      <label for="texto">Texto:</label>
      <textarea id="texto" name="texto" rows="5" required></textarea>

      <button type="submit">Cadastrar Slide</button>
    </form>

    <h2>Slides Cadastrados</h2>
    <div id="slidesList">
      <p>Carregando slides...</p>
    </div>
  </main>

  <footer>
    Desenvolvido por <a href="mailto:hugo.portelinha@gmail.com">Hugo Portelinha Cordeiro</a> | &copy; <span id="anoAtual"></span>
  </footer>

  <script>
    // Atualiza o ano automaticamente
    document.getElementById('anoAtual').textContent = new Date().getFullYear();

    const API_URL = "https://slides-629o.onrender.com";
    const slidesList = document.getElementById('slidesList');

    // Função para carregar slides do backend
    async function fetchSlides() {
      try {
        const response = await fetch(`${API_URL}/slides`);
        if (!response.ok) throw new Error('Erro ao buscar slides: ' + response.statusText);
        const slides = await response.json();
        renderSlides(slides);
      } catch (err) {
        slidesList.innerHTML = `<p>Erro ao carregar slides: ${err.message}</p>`;
      }
    }

    // Renderiza slides na tela
    function renderSlides(slides) {
      slidesList.innerHTML = '';
      if (!slides || slides.length === 0) {
        slidesList.innerHTML = '<p>Nenhum slide cadastrado ainda.</p>';
        return;
      }

      slides.forEach(slide => {
        // Estrutura de slide conforme backend (slides.js)
        const s = slide.slide || slide; // Suporta ambos formatos
        const autor = slide.autor || 'Desconhecido';

        const div = document.createElement('div');
        div.className = 'slide';
        div.innerHTML = `
          <h3>${s.assunto || '[Sem Assunto]'}</h3>
          <p><strong>Data:</strong> ${s.data ? (new Date(s.data).toLocaleDateString("pt-BR")) : '[Sem Data]'}</p>
          <p>${s.texto || '[Sem Texto]'}</p>
          <p><em>Autor: ${autor}</em></p>
        `;
        slidesList.appendChild(div);
      });
    }

    // Evento de submit do formulário
    document.getElementById('slideForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const data = document.getElementById('data').value;
      const assunto = document.getElementById('assunto').value;
      const texto = document.getElementById('texto').value;
      const autor = "Usuário Comum"; // Ajuste para usuário real se quiser

      try {
        const response = await fetch(`${API_URL}/slides`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ data, assunto, texto, autor })
        });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Erro ao cadastrar slide');
        alert(result.message || 'Slide cadastrado com sucesso!');
        this.reset();
        fetchSlides();
      } catch (err) {
        alert("Erro ao cadastrar slide: " + err.message);
      }
    });

    // Carrega os slides ao abrir a página
    fetchSlides();
  </script>
</body>
</html>

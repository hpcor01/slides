<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Slides Jurídicos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h1 { color: #333; }
    form { margin-bottom: 24px; }
    label { display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 8px; margin-top: 3px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 8px 24px; }
    .slide { background: #f4f4f4; margin-bottom: 18px; padding: 14px; border-radius: 6px; }
    .erro { color: red; margin-bottom: 10px; }
    .sucesso { color: green; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Cadastro de Slides Jurídicos</h1>
  <form id="slideForm">
    <label for="assunto">Assunto:</label>
    <input type="text" id="assunto" name="assunto" required />

    <label for="texto">Texto:</label>
    <textarea id="texto" name="texto" rows="4" required></textarea>

    <label for="autor">Autor:</label>
    <input type="text" id="autor" name="autor" />

    <button type="submit">Cadastrar Slide</button>
    <div id="msg"></div>
  </form>

  <h2>Slides cadastrados</h2>
  <div id="slides"></div>

  <script>
    async function fetchSlides() {
      const slidesDiv = document.getElementById('slides');
      slidesDiv.innerHTML = '<em>Carregando...</em>';
      try {
        const res = await fetch('/slides');
        const slides = await res.json();
        if (Array.isArray(slides) && slides.length > 0) {
          slidesDiv.innerHTML = slides.map(slide => `
            <div class="slide">
              <strong>Assunto:</strong> ${slide.assunto}<br>
              <strong>Texto:</strong> ${slide.texto}<br>
              <strong>Autor:</strong> ${slide.autor || 'Usuário Comum'}<br>
              <small><strong>Data:</strong> ${new Date(slide.data).toLocaleString()}</small>
            </div>
          `).join('');
        } else {
          slidesDiv.innerHTML = "<em>Nenhum slide cadastrado.</em>";
        }
      } catch (err) {
        slidesDiv.innerHTML = "<span class='erro'>Erro ao carregar slides.</span>";
      }
    }

    document.getElementById('slideForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const assunto = document.getElementById('assunto').value;
      const texto = document.getElementById('texto').value;
      const autor = document.getElementById('autor').value;
      const msgDiv = document.getElementById('msg');
      msgDiv.textContent = '';

      try {
        const res = await fetch('/slides', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ assunto, texto, autor })
        });
        const data = await res.json();
        if (res.ok) {
          msgDiv.textContent = data.message;
          msgDiv.className = 'sucesso';
          this.reset();
          fetchSlides();
        } else {
          msgDiv.textContent = data.error || 'Erro ao cadastrar!';
          msgDiv.className = 'erro';
        }
      } catch (err) {
        msgDiv.textContent = 'Erro ao cadastrar!';
        msgDiv.className = 'erro';
      }
    });

    // Carrega slides ao abrir a página
    fetchSlides();
  </script>
</body>
</html>